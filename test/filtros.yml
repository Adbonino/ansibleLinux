---
- name: Filtrar listaod de maquinas virtuales
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Read JSON file
      slurp:
        src: ./vms.json  # Cambia esta ruta a la ubicaci√≥n de tu archivo
      register: json_file

    - name: Set JSON data
      set_fact:
        vm_data: "{{ json_file['content'] | b64decode | from_json }}"

    - name: filtrar datos
      set_fact: filtered_entities: "{{ vm_data.json.entities | map(attribute='status') | map(attribute='cluster_reference.name') | zip(nutanix_data.json.entities | map(attribute='status.power_state')) | map('combine', {'cluster_name': item[0], 'power_state': item[1], 'id_addresses': item[0].host_reference.name, 'vn_name': item[0].name}) }}"
    
    
     - name: mostas datos
       debug:
         msg: {{ filtered_entities }}
       
