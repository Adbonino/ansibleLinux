---
- name: Filtrar listaod de maquinas virtuales
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Read JSON file
      slurp:
        src: ./vms.json  # Cambia esta ruta a la ubicaciÃ³n de tu archivo
      register: json_file

    - name: Set JSON data
      set_fact:
        vm_data: "{{ json_file['content'] | b64decode | from_json }}"

    - name: filtrar datos
      set_fact:
        filtered_entities: >
          {{
            vm_data.entities | 
            map(attribute='status') | 
            zip(nutanix_data.entities | map(attribute='status.power_state')) | 
            map('combine', {
              'cluster_name': item[0].cluster_reference.name,
              'power_state': item[1],
              'id_addresses': item[0].host_reference.name,
              'vn_name': item[0].name
            }) 
            for item in _ 
          }}
      
     - name: mostas datos
       debug:
         msg: {{ filtered_entities }}
       
